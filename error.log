 git fetch origin
git reset --hard origin/main
remote: Enumerating objects: 12, done.
remote: Counting objects: 100% (12/12), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 7 (delta 4), reused 7 (delta 4), pack-reused 0 (from 0)
Unpacking objects: 100% (7/7), 3.17 KiB | 25.00 KiB/s, done.
From https://github.com/Intership-ofty/sam
   46668c3..20c34be  main       -> origin/main
HEAD is now at 20c34be import the Keycloak realm.
[root@vmi2390455 sam]# docker compose -f deploy/compose/compose.backend.yml -f deploy/compose/compose.workers.yml -f deploy/compose/compose.client-portal.yml -f deploy/compose/compose.frontend.yml -f deploy/compose/compose.observability.yml up --build -d
Compose can now delegate builds to bake for better performance.
 To do so, set COMPOSE_BAKE=true.
[+] Building 44.3s (48/48) FINISHED                                                                                                          docker:default
 => [backend internal] load build definition from Dockerfile                                                                                           0.1s
 => => transferring dockerfile: 820B                                                                                                                   0.0s
 => [frontend internal] load build definition from Dockerfile                                                                                          0.1s
 => => transferring dockerfile: 146B                                                                                                                   0.1s
 => [frontend internal] load metadata for docker.io/library/python:3.9-slim                                                                            1.2s
 => [workers internal] load metadata for docker.io/library/python:3.11-slim                                                                            1.7s
 => [frontend internal] load .dockerignore                                                                                                             0.2s
 => => transferring context: 153B                                                                                                                      0.2s
 => [backend internal] load .dockerignore                                                                                                              0.2s
 => => transferring context: 153B                                                                                                                      0.1s
 => [frontend 1/3] FROM docker.io/library/python:3.9-slim@sha256:914169c7c8398b1b90c0b0ff921c8027445e39d7c25dc440337e56ce0f2566e6                      0.0s
 => [frontend internal] load build context                                                                                                             0.4s
 => => transferring context: 22.70kB                                                                                                                   0.2s
 => [workers 1/6] FROM docker.io/library/python:3.11-slim@sha256:1d6131b5d479888b43200645e03a78443c7157efbdb730e6b48129740727c312                      0.0s
 => [backend internal] load build context                                                                                                              1.2s
 => => transferring context: 1.42MB                                                                                                                    0.7s
 => CACHED [frontend 2/3] WORKDIR /app                                                                                                                 0.0s
 => CACHED [frontend 3/3] COPY frontend /app                                                                                                           0.0s
 => [frontend] exporting to image                                                                                                                      0.3s
 => => exporting layers                                                                                                                                0.0s
 => => writing image sha256:70a62c5e549d37df856743d4d2874c3e8eb02a273727944d829973a61b55d52a                                                           0.3s
 => => naming to docker.io/local/sam-frontend:dev                                                                                                      0.0s
 => CACHED [workers 2/6] WORKDIR /app                                                                                                                  0.0s
 => CACHED [backend 3/8] RUN apt-get update && apt-get install -y     gcc     g++     libpq-dev     curl     && rm -rf /var/lib/apt/lists/*            0.0s
 => CACHED [backend 4/8] COPY backend/requirements.txt .                                                                                               0.0s
 => CACHED [backend 5/8] RUN pip install --no-cache-dir -r requirements.txt                                                                            0.0s
 => [backend 6/8] COPY . .                                                                                                                             1.4s
 => [frontend] resolving provenance for metadata file                                                                                                  0.0s
 => [backend 7/8] RUN useradd -m -u 1000 towerco && chown -R towerco:towerco /app                                                                      9.2s
 => [backend 8/8] RUN pip check                                                                                                                       24.4s
 => [backend] exporting to image                                                                                                                       2.1s
 => => exporting layers                                                                                                                                2.1s
 => => writing image sha256:37c4304ded7a836b0c2141000bfd2277881da21ef51655db61f385e8001139d8                                                           0.0s
 => => naming to docker.io/local/sam-backend:dev                                                                                                       0.0s
 => [backend] resolving provenance for metadata file                                                                                                   0.0s
 => [workers internal] load build definition from Dockerfile                                                                                           0.0s
 => => transferring dockerfile: 716B                                                                                                                   0.0s
 => [client-portal internal] load build definition from Dockerfile                                                                                     0.1s
 => => transferring dockerfile: 1.12kB                                                                                                                 0.0s
 => [client-portal internal] load metadata for docker.io/library/node:20-alpine                                                                        0.8s
 => [workers internal] load .dockerignore                                                                                                              0.5s
 => => transferring context: 153B                                                                                                                      0.0s
 => [client-portal internal] load .dockerignore                                                                                                        0.1s
 => => transferring context: 153B                                                                                                                      0.0s
 => [workers internal] load build context                                                                                                              0.1s
 => => transferring context: 561.31kB                                                                                                                  0.1s
 => [client-portal internal] load build context                                                                                                        0.1s
 => => transferring context: 2.39kB                                                                                                                    0.0s
 => [client-portal build 1/6] FROM docker.io/library/node:20-alpine@sha256:df02558528d3d3d0d621f112e232611aecfee7cbc654f6b375765f72bb262799            0.0s
 => CACHED [client-portal build 2/6] WORKDIR /app                                                                                                      0.0s
 => CACHED [client-portal build 3/6] COPY client-portal ./                                                                                             0.0s
 => CACHED [client-portal build 4/6] RUN if [ ! -f package.json ]; then       echo '{ "name":"client-portal","version":"0.1.0","private":true, "type"  0.0s
 => CACHED [client-portal build 5/6] RUN npm ci || npm i                                                                                               0.0s
 => CACHED [client-portal build 6/6] RUN npm run build                                                                                                 0.0s
 => CACHED [client-portal stage-1 3/6] COPY --from=build /app/package.json ./package.json                                                              0.0s
 => CACHED [client-portal stage-1 4/6] COPY --from=build /app/package-lock.json* ./                                                                    0.0s
 => CACHED [client-portal stage-1 5/6] RUN npm install --production                                                                                    0.0s
 => CACHED [client-portal stage-1 6/6] COPY --from=build /app/dist ./dist                                                                              0.0s
 => CACHED [workers 3/6] RUN apt-get update && apt-get install -y --no-install-recommends     gcc g++ libpq-dev curl     && rm -rf /var/lib/apt/lists  0.0s
 => CACHED [workers 4/6] COPY workers/requirements.txt workers/requirements.txt                                                                        0.0s
 => CACHED [workers 5/6] RUN pip install --no-cache-dir -r workers/requirements.txt                                                                    0.0s
 => CACHED [workers 6/6] COPY workers/ ./workers/                                                                                                      0.0s
 => [workers] exporting to image                                                                                                                       0.0s
 => => exporting layers                                                                                                                                0.0s
 => => writing image sha256:0ae7129c8b29a8db1b663c9a09fa1045ee9ce374f237c7c3f08a9f192a231b5e                                                           0.0s
 => => naming to docker.io/local/sam-workers:dev                                                                                                       0.0s
 => [client-portal] exporting to image                                                                                                                 0.0s
 => => exporting layers                                                                                                                                0.0s
 => => writing image sha256:25b718d0e9b45a7cf5f82ef7a2f4024c1b73b0bf501a50089a916597d642e6d0                                                           0.0s
 => => naming to docker.io/local/sam-client-portal:dev                                                                                                 0.0s
 => [client-portal] resolving provenance for metadata file                                                                                             0.1s
 => [workers] resolving provenance for metadata file                                                                                                   0.1s
[+] Running 15/15
 ✔ backend                            Built                                                                                                            0.0s
 ✔ client-portal                      Built                                                                                                            0.0s
 ✔ frontend                           Built                                                                                                            0.0s
 ✔ workers                            Built                                                                                                            0.0s
 ✔ Container compose-prometheus-1     Running                                                                                                          0.0s
 ✔ Container compose-frontend-1       Running                                                                                                          0.0s
 ✔ Container compose-kafka-1          Running                                                                                                          0.0s
 ✔ Container compose-zookeeper-1      Running                                                                                                          0.0s
 ✔ Container compose-grafana-1        Running                                                                                                          0.0s
 ✔ Container compose-postgres-1       Healthy                                                                                                         14.8s
 ✔ Container compose-redis-1          Running                                                                                                          0.0s
 ✔ Container compose-backend-1        Started                                                                                                        156.0s
 ✔ Container keycloak                 Healthy                                                                                                        152.0s
 ✔ Container compose-client-portal-1  Started                                                                                                        152.6s
 ✔ Container compose-workers-1        Started                                                                                                        152.2s
[root@vmi2390455 sam]# docker ps
CONTAINER ID   IMAGE                              COMMAND                  CREATED         STATUS                          PORTS                                    NAMES
938ca2773713   local/sam-backend:dev              "uvicorn backend.mai…"   4 minutes ago   Up About a minute (unhealthy)   0.0.0.0:8000->8000/tcp                   compose-backend-1
cf4595b1eb53   quay.io/keycloak/keycloak:22.0.1   "/opt/keycloak/bin/k…"   4 minutes ago   Up 4 minutes (healthy)          8443/tcp, 0.0.0.0:8081->8080/tcp         keycloak
1b689594258a   postgres:16-alpine                 "docker-entrypoint.s…"   3 hours ago     Up 3 hours (healthy)            5432/tcp                                 compose-postgres-1
22adefc1a024   local/sam-client-portal:dev        "docker-entrypoint.s…"   13 hours ago    Up About a minute               0.0.0.0:5173->3000/tcp                   compose-client-portal-1
901df4057e94   local/sam-frontend:dev             "python -m http.serv…"   13 hours ago    Up 13 hours                     0.0.0.0:8090->8000/tcp                   compose-frontend-1
7574eb17442a   redis:7-alpine                     "docker-entrypoint.s…"   4 days ago      Up 4 days                       6379/tcp                                 compose-redis-1
e3f29fa6e9fc   bitnami/kafka:3.7                  "/opt/bitnami/script…"   4 days ago      Up 4 days                       9092/tcp                                 compose-kafka-1
ab0561ac4aaa   prom/prometheus:v2.55.0            "/bin/prometheus --c…"   4 days ago      Up 4 days                       0.0.0.0:9090->9090/tcp                   compose-prometheus-1
9be988640eec   bitnami/zookeeper:3.9              "/opt/bitnami/script…"   4 days ago      Up 4 days                       2181/tcp, 2888/tcp, 3888/tcp, 8080/tcp   compose-zookeeper-1
432dbfb07e7e   grafana/grafana:11.1.0             "/run.sh"                4 days ago      Up 4 days                       0.0.0.0:3001->3000/tcp                   compose-grafana-1
101308e7791c   minio/mc:latest                    "/bin/sh -c ' echo '…"   2 weeks ago     Up 2 weeks                                                               minio-client
9864a7b37372   minio/minio:latest                 "/usr/bin/docker-ent…"   2 weeks ago     Up 2 weeks (healthy)            0.0.0.0:9000-9001->9000-9001/tcp         minio-server
f219b96258b5   txe-web_app                        "docker-entrypoint.s…"   6 weeks ago     Up 6 weeks                      0.0.0.0:3002->3002/tcp                   txe-web_app_1
b76b69afa727   website_app                        "docker-entrypoint.s…"   4 months ago    Up 4 months                     0.0.0.0:3000->3000/tcp                   website_app_1
[root@vmi2390455 sam]# docker logs
docker: 'docker logs' requires 1 argument

Usage:  docker logs [OPTIONS] CONTAINER

Run 'docker logs --help' for more information
[root@vmi2390455 sam]# docker logs 938ca2773713
INFO:     Will watch for changes in these directories: ['/app']
WARNING:  "workers" flag is ignored when reloading is enabled.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [1] using WatchFiles
INFO:     Started server process [8]
INFO:     Waiting for application startup.
2025-09-01 16:46:27,863 - backend.main - INFO - Starting Towerco AIOps Platform...
2025-09-01 16:46:27,878 - core.monitoring - INFO - OpenTelemetry endpoint not configured, using Prometheus only
2025-09-01 16:46:27,880 - core.monitoring - INFO - Custom metrics initialized
2025-09-01 16:46:27,881 - core.monitoring - INFO - Monitoring initialized successfully
2025-09-01 16:46:30,395 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-09-01 16:46:30,395 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-01 16:46:30,395 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-09-01 16:46:30,395 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-01 16:46:30,517 INFO sqlalchemy.engine.Engine select current_schema()
2025-09-01 16:46:30,517 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-01 16:46:30,517 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-09-01 16:46:30,517 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-01 16:46:30,668 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-09-01 16:46:30,668 INFO sqlalchemy.engine.Engine [raw sql] ()
2025-09-01 16:46:30,668 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-09-01 16:46:30,668 - sqlalchemy.engine.Engine - INFO - [raw sql] ()
2025-09-01 16:46:30,714 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-09-01 16:46:30,714 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-09-01 16:46:30,738 INFO sqlalchemy.engine.Engine SELECT 1
2025-09-01 16:46:30,738 INFO sqlalchemy.engine.Engine [generated in 0.00043s] ()
2025-09-01 16:46:30,738 - sqlalchemy.engine.Engine - INFO - SELECT 1
2025-09-01 16:46:30,738 - sqlalchemy.engine.Engine - INFO - [generated in 0.00043s] ()
2025-09-01 16:46:30,779 INFO sqlalchemy.engine.Engine COMMIT
2025-09-01 16:46:30,779 - sqlalchemy.engine.Engine - INFO - COMMIT
2025-09-01 16:46:30,910 - core.database - INFO - Database connection test successful
2025-09-01 16:46:30,911 - core.database - INFO - Database connections initialized successfully
2025-09-01 16:46:31,009 - core.cache - INFO - Redis connection initialized successfully
2025-09-01 16:46:35,165 - kafka.conn - INFO - <BrokerConnection client_id=towerco_admin, node_id=bootstrap-0 host=kafka:9092 <connecting> [IPv4 ('172.23.0.2', 9092)]>: connecting to kafka:9092 [('172.23.0.2', 9092) IPv4]
2025-09-01 16:46:35,204 - kafka.conn - INFO - <BrokerConnection client_id=towerco_admin, node_id=bootstrap-0 host=kafka:9092 <checking_api_versions_recv> [IPv4 ('172.23.0.2', 9092)]>: Broker version identified as 2.6
2025-09-01 16:46:35,215 - kafka.conn - INFO - <BrokerConnection client_id=towerco_admin, node_id=bootstrap-0 host=kafka:9092 <connected> [IPv4 ('172.23.0.2', 9092)]>: Connection complete.
2025-09-01 16:46:35,306 - kafka.conn - INFO - <BrokerConnection client_id=towerco_admin, node_id=1 host=kafka:9092 <connecting> [IPv4 ('172.23.0.2', 9092)]>: connecting to kafka:9092 [('172.23.0.2', 9092) IPv4]
2025-09-01 16:46:35,311 - kafka.conn - INFO - <BrokerConnection client_id=towerco_admin, node_id=1 host=kafka:9092 <connected> [IPv4 ('172.23.0.2', 9092)]>: Connection complete.
2025-09-01 16:46:35,312 - kafka.conn - INFO - <BrokerConnection client_id=towerco_admin, node_id=bootstrap-0 host=kafka:9092 <connected> [IPv4 ('172.23.0.2', 9092)]>: Closing connection.
2025-09-01 16:46:35,448 - core.messaging - INFO - Kafka topics already exist
2025-09-01 16:46:35,448 - kafka.conn - INFO - <BrokerConnection client_id=towerco_admin, node_id=1 host=kafka:9092 <connected> [IPv4 ('172.23.0.2', 9092)]>: Closing connection.
2025-09-01 16:46:35,449 - core.messaging - INFO - Kafka producer initialized successfully
2025-09-01 16:46:36,632 - core.auth - ERROR - Keycloak connection test failed: 404: b'{"error":"Realm does not exist"}'
2025-09-01 16:46:36,632 - core.auth - ERROR - Failed to initialize Keycloak: 404: b'{"error":"Realm does not exist"}'
ERROR:    Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/starlette/routing.py", line 694, in lifespan
    async with self.lifespan_context(app) as maybe_state:
  File "/usr/local/lib/python3.11/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 134, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/usr/local/lib/python3.11/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/fastapi/routing.py", line 134, in merged_lifespan
    async with original_context(app) as maybe_original_state:
  File "/usr/local/lib/python3.11/contextlib.py", line 210, in __aenter__
    return await anext(self.gen)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/app/backend/main.py", line 50, in lifespan
    await init_auth()
  File "/app/backend/core/auth.py", line 53, in init_auth
    await test_keycloak_connection()
  File "/app/backend/core/auth.py", line 67, in test_keycloak_connection
    config = keycloak_openid.well_known()
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/keycloak/keycloak_openid.py", line 277, in well_known
    return raise_error_from_response(data_raw, KeycloakGetError)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/keycloak/exceptions.py", line 195, in raise_error_from_response
    raise error(
keycloak.exceptions.KeycloakGetError: 404: b'{"error":"Realm does not exist"}'

ERROR:    Application startup failed. Exiting.
2025-09-01 16:46:37,143 - asyncio - ERROR - Unclosed AIOKafkaProducer
producer: <aiokafka.producer.producer.AIOKafkaProducer object at 0x7fced7f8b610>